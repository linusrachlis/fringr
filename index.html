<!DOCTYPE html>
<html>

<head>
    <title>Fringr</title>
    <meta charset=utf8>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.js"></script>
</head>

<body>
    <textarea id=my-list placeholder="Paste play URLs here, one per line" rows=10 cols=100></textarea>
    <button id=refresh-button>Refresh</button>

    <div id=calendar></div>

    <script>
        $(function () {
            $('#calendar').fullCalendar({
                defaultView: 'agendaWeek',
            });

            const calendar = $('#calendar').fullCalendar('getCalendar');

            const colours = [
                {
                    color: '#ff0000',
                    textColor: 'black',
                },
                {
                    color: '#00ff00',
                    textColor: 'black',
                },
                {
                    color: '#0000ff',
                    textColor: 'white',
                },
                {
                    color: '#ffff00',
                    textColor: 'black',
                },
                {
                    color: '#00ffff',
                    textColor: 'black',
                },
                {
                    color: '#ff00ff',
                    textColor: 'black',
                },
                // TODO add more colours
            ];

            $('#refresh-button').click(function () {
                calendar.removeEventSources();
                let colourIndex = 0;
                const urlsValue = $('#my-list').val();
                const urls = urlsValue.split(/\s+/);
                for (let i = 0; i < urls.length; i++) {
                    const playUrlEncoded = encodeURIComponent(urls[i]);
                    const eventSourceUrl = 'event_source.php?play_url=' + playUrlEncoded;
                    const colour = colours[colourIndex];
                    colourIndex = (colourIndex + 1) % colours.length;
                    const eventSource = Object.assign({}, colour, {url: eventSourceUrl});
                    calendar.addEventSource(eventSource);
                }
            });
        });
    </script>
</body>

</html>
